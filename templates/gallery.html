{% extends "base.html" %}

{% block title %}All Clips{% endblock %}

{% block content %}
<div class="clips-section">
    {% if clips %}
    <div class="clips-grid">
        {% for clip in clips %}
        <div class="clip-box">
            <a href="{{ url_for('play_clip', filename=clip.filename) }}" class="clip-thumbnail-link">
                <div class="clip-thumbnail">
                    {% if clip.thumbnail %}
                    <img src="{{ url_for('static', filename=clip.thumbnail) }}" alt="Thumbnail for {{ clip.human_label }}">
                    {% else %}
                    <p>▶ Play Clip</p>
                    {% endif %}
                </div>
            </a>
            <div class="clip-info">
                <p>{{ clip.human_label }}</p>
            </div>
            <div class="clip-actions">
                <a href="{{ url_for('static', filename='clips/' + clip.filename) }}" download class="action-icon" title="Download">
                    <img src="{{ url_for('static', filename='download.svg') }}" alt="Download">
                </a>
                <button class="action-icon delete-button" data-filename="{{ clip.filename }}" title="Delete">
                    <img src="{{ url_for('static', filename='delete.svg') }}" alt="Delete">
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No clips recorded yet.</p>
    {% endif %}
</div>

<nav class="pagination">
    {% if page > 1 %}
        <a href="{{ url_for('gallery', page=page-1) }}" class="page-link">« Previous</a>
    {% endif %}

    <span class="page-current">Page {{ page }} of {{ total_pages }}</span>

    {% if page < total_pages %}
        <a href="{{ url_for('gallery', page=page+1) }}" class="page-link">Next »</a>
    {% endif %}
</nav>

<style>
    .pagination {
        text-align: center;
        margin: 2rem 0;
    }
    .page-link, .page-current {
        display: inline-block;
        padding: 0.5rem 1rem;
        margin: 0 0.25rem;
        border-radius: 5px;
    }
    .page-link {
        text-decoration: none;
        background-color: #007bff;
        color: white;
    }
    .page-link:hover {
        background-color: #0056b3;
    }
    .page-current {
        color: #ccc;
    }
</style>
{% endblock %}

{% block scripts %}
{# Re-add the delete script for this page #}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const clipsGrid = document.querySelector('.clips-grid');
        if (clipsGrid) {
            clipsGrid.addEventListener('click', function(event) {
                const deleteButton = event.target.closest('.delete-button');
                if (!deleteButton) return;

                event.preventDefault();
                event.stopPropagation();

                const filename = deleteButton.dataset.filename;
                if (confirm(`Are you sure you want to delete the clip "${filename}"?`)) {
                    fetch(`/delete/${filename}`, {
                        method: 'POST',
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const clipBox = deleteButton.closest('.clip-box');
                            if (clipBox) {
                                clipBox.style.transition = 'opacity 0.5s';
                                clipBox.style.opacity = '0';
                                setTimeout(() => clipBox.remove(), 500);
                            }
                        } else {
                            alert(`Error deleting file: ${data.error || 'Unknown error'}`);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while trying to delete the file.');
                    });
                }
            });
        }
    });
</script>
{% endblock %}
